<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prithvi Guest Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; padding:20px; }
.container { background:white; padding:25px; border-radius:10px; max-width:1000px; margin:auto; }
h2 { text-align:center; }
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border:1px solid #ccc; padding:8px; text-align:left; }
th { background:#007bff; color:white; }
input { padding:8px; width:200px; margin-bottom:10px; }
button { padding:8px 12px; margin-left:5px; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
<h2>Prithvi Guest Room Dashboard</h2>

<div id="loginDiv">
  <label>Password:</label>
  <input type="password" id="adminPassword">
  <button onclick="checkPassword()">Login</button>
</div>

<div id="dashboard" style="display:none;">
  <button onclick="exportTable()">Export CSV</button>
  <input type="text" id="searchInput" placeholder="Search..." onkeyup="searchTable()">
  <table id="dataTable">
    <thead>
      <tr id="tableHeader"></tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
const ADMIN_PASSWORD = "Prithvi@123";

function checkPassword(){
  const pass = document.getElementById("adminPassword").value;
  if(pass === ADMIN_PASSWORD){
    document.getElementById("loginDiv").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
    loadData();
  } else {
    alert("Incorrect password");
  }
}

function loadData(){
  fetch("https://script.google.com/macros/s/AKfycbz133gfJxR4T4im9dQ7JIQmvbym15d7SPi2vKMzKUeBjpcccit3d6DSp1K0z1g2BkrA/exec?dashboard=true")
    .then(res => res.json())
    .then(data => {
      if(data.length==0) return;
      const headerRow = document.getElementById("tableHeader");
      headerRow.innerHTML="";
      Object.keys(data[0]).forEach(key=>{
        const th = document.createElement("th");
        th.textContent = key;
        headerRow.appendChild(th);
      });
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML="";
      data.forEach(row=>{
        const tr = document.createElement("tr");
        Object.values(row).forEach(val=>{
          const td = document.createElement("td");
          td.textContent = val;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    });
}

function searchTable(){
  const input = document.getElementById("searchInput").value.toLowerCase();
  const table = document.getElementById("dataTable");
  const trs = table.tBodies[0].rows;
  for(let i=0;i<trs.length;i++){
    const rowText = trs[i].textContent.toLowerCase();
    trs[i].style.display = rowText.includes(input) ? "" : "none";
  }
}

function exportTable(){
  let csv = [];
  const rows = document.querySelectorAll("table tr");
  rows.forEach(row=>{
    let cols = row.querySelectorAll("td, th");
    let rowData = [];
    cols.forEach(col=>rowData.push('"' + col.innerText + '"'));
    csv.push(rowData.join(","));
  });
  const csvString = csv.join("\n");
  const blob = new Blob([csvString], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "prithvi_guest_data.csv";
  a.click();
});
}
</script>
</div>
</body>
</html>
